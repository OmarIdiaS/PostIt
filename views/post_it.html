{% extends "base.html" %}

{% block title %}Post_it{% endblock %}

{% block head %} 

    <link rel="stylesheet" href="public/style.css"> 
    

{% endblock %}

{% block main %}


<body id="post_it"> 
<table>
  <tr>
  <td>Welcome {{current}}</td>
    <form action="/admindelete" method="post">
    <a href="/" class="submit"><input type="image" src="https://cdn.glitch.com/e7146dd9-331b-4c07-9d68-fd24547f0732%2Fsuppr-ConvertImage.png?1554507094885" value="DELETE"></a>
    </form>
    </tr>
  
</table>
  
<table>
  
{% for d in donn %}

  <tr>
   
    <td>{{d.txt}}<textarea name="txt"  style="display:none;" >{{d.txt}}</textarea></td>
     
    <td>{{d.datee}}<textarea name="datee"  style="display:none;" >{{d.datee}}</textarea></td>
    
    <td>{{d.coor}}</td>
    
   <form action="/suppr" method="post">
      
    <td><textarea name="img"  style="display:none;">{{d.id}}</textarea></td>
      
    <td>{{d.useer}}</td>
    <!--<td><input  type="texte"  name="mach"  ></td>-->
    <td><a href = "/" class="submit" ><input type="image" src="https://cdn.glitch.com/e7146dd9-331b-4c07-9d68-fd24547f0732%2Fsuppr-ConvertImage.png?1554507094885" value="Delete" ></a></td>
      <!--<td><textarea name="mach"  ></textarea></td>-->
      
      
      <!--<td><a href = "/" class="submit"  ><input type="image" src="https://cdn.glitch.com/e7146dd9-331b-4c07-9d68-fd24547f0732%2Fsuppr-ConvertImage.png?1554507094885" value="Update"></a></td>-->
     
    </form>
     <td><a onclick="s('{{d.id}}', '{{d.useer}}' , '{{d.txt}}', '{{d.datee}}' , '{{d.coor}}')"  ><input type="image" src="https://cdn.glitch.com/e7146dd9-331b-4c07-9d68-fd24547f0732%2Fsuppr-ConvertImage.png?1554507094885"  ></a></td>
    
      </tr>
 
{% endfor %}
  
  
</table>
  
  <script>
//setInterval(function(){ window.location.reload();}, 3000);
    document.getElementById("post_it").ondblclick = function() {myfunction()};
 /*
    function allowDrop(ev){
	ev.preventDefault(); 
}	

function dragStart(ev){
	
	id = ev.target.id ; 
	alert(id);
	
}

function drop(ev){
	
	ev.target.append(document.getElementById(id));
}
 */
    
    
    //function s(x,y){console.log(x +  "" + y);}
    
    function s(x,y,z,a,b){
   
   var texte = prompt("Saisir votre texte ::");
   
   var xhr = new XMLHttpRequest();
    var url = "/modif";
    

   
    xhr.onreadystatechange = function () {
      if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
        var json = JSON.stringify(xhr.responseText);
        alert("les donnees sont envoyer a la BD");
        window.location.reload();

      }
    };
 // s('{{d.id}}', '{{d.useer}}' , '{{d.txt}}', '{{d.datee}}' , '{{d.coor}}')
  var data = {id: x,txt : z ,datee : a,coor : b , texte};
  xhr.open("POST", url, true); 
  xhr.setRequestHeader("Content-Type", "application/json");
  xhr.send(JSON.stringify(data));
  console.log('okk');
 
   
 };
    
    
 
    
 function myfunction() {
   
   // Coordonnees
    var x = event.clientX ; 
	  var y = event.clientY; 
	  var coor = "X :" + x + " Y :"  + y ;
  
   // Date
   var d = new Date(); 
	
	var j = d.getDate(); 
	var mois = d.getMonth() + 1; 
	var annee = d.getFullYear(); 
	var h = d.getHours(); 
	var m = d.getMinutes();
   var date = j+"/"+mois+"/"+annee+"  "+h+":"+m ; 
   
   //TEXTE
   
   var texte = prompt("Saisir votre texte ::");
   
    var xhr = new XMLHttpRequest();
    var url = "/p";
    xhr.open("POST", url, true); 

   
    xhr.onreadystatechange = function () {
      if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
        var json = JSON.stringify(xhr.responseText);
        alert("les donnees sont envoyer a la BD");
        //window.setInterval(window.location.reload(),2)
        window.location.reload();
//                setInterval(function(){ window.location.reload();}, 3000);

      //settimeout(setInterval(function(){ window.location.reload();}, 4000);


      //window.location.reload();
      }
    };
  
  var data = { txt : texte, datee : date, coor : coor};
  xhr.setRequestHeader("Content-Type", "application/json");
  xhr.send(JSON.stringify(data));
  console.log('okk');
   
 }
    
    
   
    
</script>
  
 <!-- <div>
    {% for d in donn %}
    <p> {{ d.login }}</p>
    <p> {{ d.txt }}</p>
    <p> {{ d.coor }}</p>
    {% endfor %}
  </div>-->
  
  
  
</body>
{% endblock %}